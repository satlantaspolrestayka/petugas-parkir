<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    
    <title>Login Petugas Parkir</title>
    
    <style>
        /* ====== UNIVERSAL RESET ====== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-text-size-adjust: 100%;
            -moz-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
        }
        
        html {
            height: 100%;
            overflow: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        body {
            min-height: 100vh;
            min-height: -webkit-fill-available;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a2980 0%, #26d0ce 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        /* ====== LOGIN PAGE ====== */
        .login-container {
            width: 100%;
            max-width: 450px;
            background: white;
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideUp 0.6s ease;
        }
        
        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .login-header {
            background: linear-gradient(135deg, #2c3e50 0%, #4a6491 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .login-header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 30px 30px;
            opacity: 0.3;
            animation: float 20s linear infinite;
        }
        
        @keyframes float {
            0% { transform: translate(0, 0) rotate(0deg); }
            100% { transform: translate(-30px, -30px) rotate(360deg); }
        }
        
        .header-content {
            position: relative;
            z-index: 2;
        }
        
        .login-icon {
            font-size: 60px;
            margin-bottom: 20px;
            display: inline-block;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .login-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .login-subtitle {
            opacity: 0.9;
            font-size: 16px;
            font-weight: 300;
        }
        
        /* ====== LOGIN FORM ====== */
        .login-form {
            padding: 40px 30px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-label {
            display: block;
            font-size: 16px;
            color: #2c3e50;
            margin-bottom: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-label::before {
            content: 'üìç';
            font-size: 20px;
        }
        
        .form-label.password::before {
            content: 'üîí';
        }
        
        .password-info {
            font-size: 12px;
            color: #64748b;
            margin-top: 8px;
            margin-bottom: 15px;
            padding: 10px;
            background: #f8fafc;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .lokasi-select {
            width: 100%;
            padding: 18px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            font-size: 16px;
            background: white;
            color: #333;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23333' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 20px center;
            background-size: 20px;
            padding-right: 50px;
            transition: all 0.3s ease;
        }
        
        .lokasi-select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .password-input {
            width: 100%;
            padding: 18px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            font-size: 16px;
            background: white;
            color: #333;
            transition: all 0.3s ease;
            font-family: monospace;
            letter-spacing: 2px;
            text-align: center;
            font-weight: 600;
        }
        
        .password-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .password-input.error {
            border-color: #ef4444;
            background-color: #fef2f2;
        }
        
        .password-input.success {
            border-color: #10b981;
            background-color: #f0fdf4;
        }
        
        .login-btn {
            width: 100%;
            padding: 20px;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: 700;
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(46, 204, 113, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .login-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .login-btn:hover::before {
            left: 100%;
        }
        
        .login-btn:active {
            transform: scale(0.98);
            box-shadow: 0 2px 10px rgba(46, 204, 113, 0.4);
        }
        
        .login-btn:disabled {
            background: linear-gradient(135deg, #9ca3af, #6b7280);
            cursor: not-allowed;
            opacity: 0.7;
            box-shadow: none;
        }
        
        /* ====== INPUT PAGE (HIDDEN INITIALLY) ====== */
        .input-container {
            width: 100%;
            max-width: 500px;
            background: white;
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            display: none;
        }
        
        .input-header {
            background: linear-gradient(135deg, #2c3e50 0%, #4a6491 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }
        
        .lokasi-info {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .lokasi-badge {
            display: inline-block;
            background: linear-gradient(135deg, #3498db, #2ecc71);
            color: white;
            padding: 8px 20px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 15px;
        }
        
        .lokasi-nama {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .lokasi-alamat {
            opacity: 0.9;
            font-size: 16px;
        }
        
        /* ====== INPUT FORM ====== */
        .input-form {
            padding: 30px;
        }
        
        .input-title {
            font-size: 20px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 25px;
            text-align: center;
        }
        
        .kapasitas-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .input-card {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            padding: 25px 20px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .input-card:focus-within {
            border-color: #3498db;
            box-shadow: 0 5px 20px rgba(52, 152, 219, 0.1);
            transform: translateY(-5px);
        }
        
        .card-icon {
            font-size: 40px;
            margin-bottom: 15px;
            display: block;
        }
        
        .card-label {
            display: block;
            font-size: 14px;
            color: #64748b;
            margin-bottom: 15px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .capacity-info {
            font-size: 12px;
            color: #94a3b8;
            margin-top: 8px;
            font-style: italic;
        }
        
        .number-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 32px;
            font-weight: 800;
            text-align: center;
            color: #2c3e50;
            background: white;
            -webkit-appearance: none;
            -moz-appearance: textfield;
            font-family: 'Arial Black', sans-serif;
            transition: all 0.3s ease;
        }
        
        .number-input:focus {
            outline: none;
            border-color: #3498db;
            background-color: #f0f9ff;
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
        }
        
        .number-input.error {
            border-color: #ef4444;
            background-color: #fef2f2;
        }
        
        .number-input.warning {
            border-color: #f59e0b;
            background-color: #fffbeb;
        }
        
        .number-input:disabled {
            background-color: #f1f5f9;
            color: #94a3b8;
            cursor: not-allowed;
        }
        
        .number-input::-webkit-outer-spin-button,
        .number-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        /* ====== ACTION BUTTONS ====== */
        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        
        .btn-submit {
            padding: 18px;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 700;
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);
        }
        
        .btn-submit:disabled {
            background: linear-gradient(135deg, #9ca3af, #6b7280);
            cursor: not-allowed;
            opacity: 0.7;
            box-shadow: none;
        }
        
        .btn-logout {
            padding: 18px;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 700;
            background: white;
            color: #64748b;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
        }
        
        .btn-submit:active:not(:disabled),
        .btn-logout:active {
            transform: scale(0.98);
        }
        
        /* ====== STATUS BAR ====== */
        .status-bar {
            padding: 20px 30px;
            background: #f8f9fa;
            border-top: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .status-text {
            font-size: 14px;
            color: #64748b;
        }
        
        .status-time {
            font-size: 14px;
            font-weight: 600;
            color: #3498db;
        }
        
        /* ====== RESPONSIVE ====== */
        @media (max-width: 768px) {
            .login-container,
            .input-container {
                border-radius: 20px;
            }
            
            .login-header,
            .input-header {
                padding: 30px 20px;
            }
            
            .login-title {
                font-size: 24px;
            }
            
            .login-form,
            .input-form {
                padding: 30px 20px;
            }
            
            .kapasitas-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .action-buttons {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 15px;
            }
            
            .login-title {
                font-size: 22px;
            }
            
            .lokasi-nama {
                font-size: 20px;
            }
            
            .number-input {
                font-size: 28px;
                padding: 12px;
            }
            
            .password-input {
                padding: 15px;
                font-size: 18px;
            }
        }
        
        /* Landscape Mode */
        @media (orientation: landscape) and (max-height: 600px) {
            .login-container,
            .input-container {
                max-height: 95vh;
                overflow-y: auto;
            }
            
            .login-header,
            .input-header {
                padding: 20px;
            }
            
            .kapasitas-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        /* Dark Mode */
        @media (prefers-color-scheme: dark) {
            body {
                background: linear-gradient(135deg, #0f172a, #1e293b);
            }
            
            .login-container,
            .input-container {
                background: #1e293b;
                color: #e2e8f0;
            }
            
            .login-header,
            .input-header {
                background: linear-gradient(135deg, #0f172a, #334155);
            }
            
            .lokasi-select {
                background-color: #334155;
                border-color: #475569;
                color: #e2e8f0;
                background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23e2e8f0' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            }
            
            .password-input {
                background-color: #334155;
                border-color: #475569;
                color: #e2e8f0;
            }
            
            .password-input.error {
                border-color: #dc2626;
                background-color: #450a0a;
            }
            
            .password-input.success {
                border-color: #10b981;
                background-color: #064e3b;
            }
            
            .input-card {
                background: #334155;
                border-color: #475569;
            }
            
            .number-input {
                background: #1e293b;
                border-color: #475569;
                color: #f8fafc;
            }
            
            .number-input:focus {
                background-color: #0c4a6e;
                border-color: #38bdf8;
            }
            
            .number-input.error {
                border-color: #dc2626;
                background-color: #450a0a;
            }
            
            .number-input.warning {
                border-color: #d97706;
                background-color: #451a03;
            }
            
            .number-input:disabled {
                background-color: #374151;
                color: #9ca3af;
            }
            
            .capacity-info {
                color: #cbd5e1;
            }
            
            .password-info {
                background: #334155;
                color: #cbd5e1;
                border-left-color: #38bdf8;
            }
            
            .status-bar {
                background: #334155;
                border-top-color: #475569;
            }
            
            .btn-logout {
                background: #334155;
                border-color: #475569;
                color: #e2e8f0;
            }
        }
    </style>
</head>
<body>
    <!-- ====== LOGIN PAGE ====== -->
    <div class="login-container" id="loginPage">
        <div class="login-header">
            <div class="header-content">
                <div class="login-icon">üöó</div>
                <h1 class="login-title">PETUGAS PARKIR</h1>
                <p class="login-subtitle">Operasi Lilin Progo 2025</p>
            </div>
        </div>
        
        <div class="login-form">
            <div class="form-group">
                <label class="form-label">PILIH LOKASI PARKIR ANDA</label>
                <select class="lokasi-select" id="lokasiLogin">
                    <option value="">-- Pilih Lokasi --</option>
                    <option value="1">1. SENOPATI - JL P. SENOPATI</option>
                    <option value="2">2. NGABEAN - JL W. HASYIM</option>
                    <option value="3">3. SRI WEDANI - JL SRI WEDANI</option>
                    <option value="4">4. SPRAGA - JL KHA DAHLAN</option>
                    <option value="5">5. RAMAI MALL - JL BESKALAN</option>
                    <option value="6">6. GRAND ZURI - JL MARGO UTOMO</option>
                    <option value="7">7. EX MANOA CAFE - JL ABU BAKAR ALI</option>
                    <option value="8">8. MALIOBORO II - JL PABRINGAN</option>
                    <option value="9">9. MALIOBORO III - JL KETANDAN 7</option>
                    <option value="10">10. UTARA CAVINTON - JL LETJEND SUPRAPTO</option>
                    <option value="11">11. GEMBIRA LOKA - JL KEBUN RAYA</option>
                    <option value="12">12. KAWULA ALIT - JL GANDEKAN</option>
                    <option value="13">13. PARKIRAN KOMANDO - JL SUDIRMAN</option>
                    <option value="14">14. EKS TRIO - JL MARGOUTOMO</option>
                    <option value="15">15. STADION KRIDOSONO - JL YOS SUDARSO</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label password">PASSWORD LOKASI</label>
                <div class="password-info">
                    ‚ìò Password sesuai dengan nomor urut lokasi yang dipilih
                </div>
                <input type="password" 
                       class="password-input" 
                       id="passwordInput"
                       placeholder="Masukkan password angka"
                       maxlength="2"
                       inputmode="numeric"
                       oninput="validatePassword()">
            </div>
            
            <button class="login-btn" id="loginBtn" onclick="login()">
                <span>‚Üí</span> MASUK KE APLIKASI
            </button>
        </div>
    </div>
    
    <!-- ====== INPUT PAGE ====== -->
    <div class="input-container" id="inputPage">
        <div class="input-header">
            <div class="lokasi-badge" id="lokasiBadge">LOKASI 8</div>
            <div class="lokasi-nama" id="lokasiNama">MALIOBORO II</div>
            <div class="lokasi-alamat" id="lokasiAlamat">JL PABRINGAN</div>
            
            <div class="lokasi-info">
                <div style="font-size: 14px; opacity: 0.9;">Masukkan jumlah tempat parkir yang tersedia</div>
            </div>
        </div>
        
        <div class="input-form">
            <h2 class="input-title">KAPASITAS TERSEDIA</h2>
            
            <div class="kapasitas-grid">
                <!-- BUS -->
                <div class="input-card">
                    <div class="card-icon">üöå</div>
                    <label class="card-label">BUS</label>
                    <div class="capacity-info" id="busMaxInfo">Maks: -</div>
                    <input type="number" 
                           class="number-input" 
                           id="busInput"
                           value="0"
                           min="0"
                           placeholder="0"
                           inputmode="numeric">
                </div>
                
                <!-- MOBIL -->
                <div class="input-card">
                    <div class="card-icon">üöó</div>
                    <label class="card-label">MOBIL</label>
                    <div class="capacity-info" id="mobilMaxInfo">Maks: -</div>
                    <input type="number" 
                           class="number-input" 
                           id="mobilInput"
                           value="0"
                           min="0"
                           placeholder="0"
                           inputmode="numeric">
                </div>
                
                <!-- MOTOR -->
                <div class="input-card">
                    <div class="card-icon">üèçÔ∏è</div>
                    <label class="card-label">MOTOR</label>
                    <div class="capacity-info" id="motorMaxInfo">Maks: -</div>
                    <input type="number" 
                           class="number-input" 
                           id="motorInput"
                           value="0"
                           min="0"
                           placeholder="0"
                           inputmode="numeric">
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn-logout" onclick="logout()">
                    <span>‚Üê</span> GANTI LOKASI
                </button>
                <button class="btn-submit" id="submitBtn" onclick="submitData()">
                    <span>‚úì</span> KIRIM DATA
                </button>
            </div>
        </div>
        
        <div class="status-bar">
            <div class="status-text" id="statusText">Siap menerima input</div>
            <div class="status-time" id="currentTime">14:30</div>
        </div>
    </div>

    <script>
        // ====== DATA KAPASITAS MAKSIMAL DARI CSV ======
        const kapasitasData = {
            "1": { nama: "SENOPATI", alamat: "JL P. SENOPATI", bus: 62, mobil: 200, motor: null },
            "2": { nama: "NGABEAN", alamat: "JL W. HASYIM", bus: 60, mobil: 80, motor: 100 },
            "3": { nama: "SRI WEDANI", alamat: "JL SRI WEDANI", bus: null, mobil: 60, motor: 250 },
            "4": { nama: "SPRAGA", alamat: "JL KHA DAHLAN", bus: 30, mobil: 50, motor: null },
            "5": { nama: "RAMAI MALL", alamat: "JL BESKALAN", bus: null, mobil: 20, motor: 382 },
            "6": { nama: "GRAND ZURI", alamat: "JL MARGO UTOMO", bus: 100, mobil: 50, motor: null },
            "7": { nama: "EX MANOA CAFE", alamat: "JL ABU BAKAR ALI", bus: 20, mobil: 50, motor: null },
            "8": { nama: "MALIOBORO II", alamat: "JL PABRINGAN", bus: null, mobil: 115, motor: 250 },
            "9": { nama: "MALIOBORO III", alamat: "JL KETANDAN 7", bus: null, mobil: 125, motor: null },
            "10": { nama: "UTARA CAVINTON", alamat: "JL LETJEND SUPRAPTO", bus: 40, mobil: 150, motor: null },
            "11": { nama: "GEMBIRA LOKA", alamat: "JL KEBUN RAYA", bus: 82, mobil: 100, motor: 300 },
            "12": { nama: "KAWULA ALIT", alamat: "JL GANDEKAN", bus: null, mobil: 100, motor: 200 },
            "13": { nama: "PARKIRAN KOMANDO", alamat: "JL SUDIRMAN", bus: null, mobil: 60, motor: 200 },
            "14": { nama: "EKS TRIO", alamat: "JL MARGOUTOMO", bus: 130, mobil: 300, motor: null },
            "15": { nama: "STADION KRIDOSONO", alamat: "JL YOS SUDARSO", bus: null, mobil: null, motor: null }
        };

        // ====== DATA LOKASI ======
        const lokasiData = {
            "1": { nama: "SENOPATI", alamat: "JL P. SENOPATI" },
            "2": { nama: "NGABEAN", alamat: "JL W. HASYIM" },
            "3": { nama: "SRI WEDANI", alamat: "JL SRI WEDANI" },
            "4": { nama: "SPRAGA", alamat: "JL KHA DAHLAN" },
            "5": { nama: "RAMAI MALL", alamat: "JL BESKALAN" },
            "6": { nama: "GRAND ZURI", alamat: "JL MARGO UTOMO" },
            "7": { nama: "EX MANOA CAFE", alamat: "JL ABU BAKAR ALI" },
            "8": { nama: "MALIOBORO II", alamat: "JL PABRINGAN" },
            "9": { nama: "MALIOBORO III", alamat: "JL KETANDAN 7" },
            "10": { nama: "UTARA CAVINTON", alamat: "JL LETJEND SUPRAPTO" },
            "11": { nama: "GEMBIRA LOKA", alamat: "JL KEBUN RAYA" },
            "12": { nama: "KAWULA ALIT", alamat: "JL GANDEKAN" },
            "13": { nama: "PARKIRAN KOMANDO", alamat: "JL SUDIRMAN" },
            "14": { nama: "EKS TRIO", alamat: "JL MARGOUTOMO" },
            "15": { nama: "STADION KRIDOSONO", alamat: "JL YOS SUDARSO" }
        };

        // ====== VARIABLES ======
        let currentLokasi = null;
        let inputTimer = null;

        // ====== PASSWORD VALIDATION ======
        function validatePassword() {
            const lokasiSelect = document.getElementById('lokasiLogin');
            const passwordInput = document.getElementById('passwordInput');
            const loginBtn = document.getElementById('loginBtn');
            
            const selectedLokasi = lokasiSelect.value;
            const enteredPassword = passwordInput.value.trim();
            
            // Reset styles
            passwordInput.classList.remove('error', 'success');
            loginBtn.disabled = true;
            
            if (!selectedLokasi) {
                passwordInput.classList.add('error');
                return false;
            }
            
            // Expected password is the location number (e.g., "1" for SENOPATI)
            const expectedPassword = selectedLokasi;
            
            if (enteredPassword === expectedPassword) {
                passwordInput.classList.add('success');
                loginBtn.disabled = false;
                return true;
            } else if (enteredPassword.length > 0) {
                passwordInput.classList.add('error');
                return false;
            }
            
            return false;
        }

        // ====== AUTO-FILL PASSWORD ON LOCATION SELECT ======
        function setupPasswordAutoFill() {
            const lokasiSelect = document.getElementById('lokasiLogin');
            const passwordInput = document.getElementById('passwordInput');
            
            lokasiSelect.addEventListener('change', function() {
                if (this.value) {
                    // Auto-fill password with location number
                    passwordInput.value = this.value;
                    validatePassword();
                    passwordInput.focus();
                    passwordInput.select();
                } else {
                    passwordInput.value = '';
                    passwordInput.classList.remove('error', 'success');
                }
            });
            
            // Also validate when password is typed
            passwordInput.addEventListener('input', validatePassword);
        }

        // ====== LOGIN FUNCTION ======
        function login() {
            const select = document.getElementById('lokasiLogin');
            const passwordInput = document.getElementById('passwordInput');
            const lokasiId = select.value;
            const password = passwordInput.value.trim();
            
            // Validate location selection
            if (!lokasiId) {
                alert("Silakan pilih lokasi parkir Anda terlebih dahulu");
                select.focus();
                return;
            }
            
            // Validate password
            const expectedPassword = lokasiId;
            if (password !== expectedPassword) {
                alert("Password salah! Password harus sesuai dengan nomor urut lokasi.\n\nContoh: Lokasi 1 ‚Üí Password: 1\nLokasi 8 ‚Üí Password: 8");
                passwordInput.classList.add('error');
                passwordInput.focus();
                passwordInput.select();
                return;
            }
            
            // Set current lokasi
            currentLokasi = lokasiId;
            
            // Update UI with lokasi info
            document.getElementById('lokasiBadge').textContent = `LOKASI ${lokasiId}`;
            document.getElementById('lokasiNama').textContent = lokasiData[lokasiId].nama;
            document.getElementById('lokasiAlamat').textContent = lokasiData[lokasiId].alamat;
            
            // Update max capacity info
            updateCapacityInfo(lokasiId);
            
            // Load draft data if exists
            loadDraftData(lokasiId);
            
            // Switch to input page
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('inputPage').style.display = 'block';
            
            // Clear password field for security
            passwordInput.value = '';
            passwordInput.classList.remove('success', 'error');
            
            // Focus on first input
            setTimeout(() => {
                const busInput = document.getElementById('busInput');
                if (kapasitasData[lokasiId].bus !== null) {
                    busInput.focus();
                } else if (kapasitasData[lokasiId].mobil !== null) {
                    document.getElementById('mobilInput').focus();
                } else if (kapasitasData[lokasiId].motor !== null) {
                    document.getElementById('motorInput').focus();
                }
            }, 300);
            
            console.log(`‚úÖ Petugas masuk untuk lokasi ${lokasiId}: ${lokasiData[lokasiId].nama}`);
            
            // Log login activity
            logLoginActivity(lokasiId);
        }

        // ====== LOGIN ACTIVITY LOG ======
        function logLoginActivity(lokasiId) {
            try {
                const logs = JSON.parse(localStorage.getItem('loginLogs') || '[]');
                logs.push({
                    lokasiId: lokasiId,
                    lokasiNama: lokasiData[lokasiId].nama,
                    timestamp: new Date().toISOString(),
                    type: 'login'
                });
                
                // Keep only last 50 logs
                const trimmed = logs.slice(-50);
                localStorage.setItem('loginLogs', JSON.stringify(trimmed));
                
                console.log(`üìù Log login untuk lokasi ${lokasiId}`);
            } catch (error) {
                console.error('Error logging login activity:', error);
            }
        }

        // ====== UPDATE CAPACITY INFO ======
        function updateCapacityInfo(lokasiId) {
            const kapasitas = kapasitasData[lokasiId];
            
            // Update max info display
            document.getElementById('busMaxInfo').textContent = 
                kapasitas.bus !== null ? `Maks: ${kapasitas.bus}` : "Tidak tersedia";
            
            document.getElementById('mobilMaxInfo').textContent = 
                kapasitas.mobil !== null ? `Maks: ${kapasitas.mobil}` : "Tidak tersedia";
            
            document.getElementById('motorMaxInfo').textContent = 
                kapasitas.motor !== null ? `Maks: ${kapasitas.motor}` : "Tidak tersedia";
            
            // Set max attributes and disable/enable inputs
            const busInput = document.getElementById('busInput');
            const mobilInput = document.getElementById('mobilInput');
            const motorInput = document.getElementById('motorInput');
            
            if (kapasitas.bus !== null) {
                busInput.max = kapasitas.bus;
                busInput.disabled = false;
                busInput.placeholder = `0-${kapasitas.bus}`;
                busInput.value = 0; // Reset to 0
            } else {
                busInput.disabled = true;
                busInput.value = '';
                busInput.placeholder = "Tidak tersedia";
            }
            
            if (kapasitas.mobil !== null) {
                mobilInput.max = kapasitas.mobil;
                mobilInput.disabled = false;
                mobilInput.placeholder = `0-${kapasitas.mobil}`;
                mobilInput.value = 0; // Reset to 0
            } else {
                mobilInput.disabled = true;
                mobilInput.value = '';
                mobilInput.placeholder = "Tidak tersedia";
            }
            
            if (kapasitas.motor !== null) {
                motorInput.max = kapasitas.motor;
                motorInput.disabled = false;
                motorInput.placeholder = `0-${kapasitas.motor}`;
                motorInput.value = 0; // Reset to 0
            } else {
                motorInput.disabled = true;
                motorInput.value = '';
                motorInput.placeholder = "Tidak tersedia";
            }
        }

        // ====== VALIDATE INPUT ======
        function validateInput(inputId, maxValue) {
            const input = document.getElementById(inputId);
            
            if (input.disabled) {
                return null; // Return null for disabled inputs
            }
            
            const value = parseInt(input.value) || 0;
            
            if (maxValue === null || maxValue === undefined) {
                return 0;
            }
            
            if (value > maxValue) {
                // Show warning and auto-correct to max value
                input.classList.add('warning');
                setTimeout(() => {
                    input.classList.remove('warning');
                }, 2000);
                
                // Auto-correct to max value
                const correctedValue = maxValue;
                input.value = correctedValue;
                
                // Show toast notification
                showToast(`Diubah ke maksimum: ${correctedValue}`, 'warning');
                
                return correctedValue;
            }
            
            // Remove any error/warning classes
            input.classList.remove('error', 'warning');
            return value;
        }

        // ====== LOGOUT FUNCTION ======
        function logout() {
            // Save draft before logout
            saveDraftData();
            
            // Reset to login page
            document.getElementById('inputPage').style.display = 'none';
            document.getElementById('loginPage').style.display = 'block';
            
            // Reset form
            document.getElementById('lokasiLogin').value = '';
            document.getElementById('passwordInput').value = '';
            document.getElementById('passwordInput').classList.remove('success', 'error');
            currentLokasi = null;
            
            // Reset login button
            document.getElementById('loginBtn').disabled = true;
            
            console.log('üëã Petugas logout');
        }

        // ====== LOAD DRAFT DATA ======
        function loadDraftData(lokasiId) {
            try {
                const drafts = JSON.parse(localStorage.getItem('parkirDrafts') || '{}');
                const draft = drafts[lokasiId];
                const kapasitas = kapasitasData[lokasiId];
                
                if (draft) {
                    // Set values with validation
                    const busInput = document.getElementById('busInput');
                    const mobilInput = document.getElementById('mobilInput');
                    const motorInput = document.getElementById('motorInput');
                    
                    // Only load if input is enabled (capacity exists)
                    if (!busInput.disabled && draft.bus !== undefined) {
                        const busValue = Math.min(draft.bus || 0, kapasitas.bus || 0);
                        busInput.value = busValue;
                    }
                    
                    if (!mobilInput.disabled && draft.mobil !== undefined) {
                        const mobilValue = Math.min(draft.mobil || 0, kapasitas.mobil || 0);
                        mobilInput.value = mobilValue;
                    }
                    
                    if (!motorInput.disabled && draft.motor !== undefined) {
                        const motorValue = Math.min(draft.motor || 0, kapasitas.motor || 0);
                        motorInput.value = motorValue;
                    }
                    
                    updateStatus(`Data draft ditemukan (${formatTime(draft.timestamp)})`, '#f59e0b');
                }
            } catch (error) {
                console.log('No draft data found');
            }
        }

        // ====== SAVE DRAFT DATA ======
        function saveDraftData() {
            if (!currentLokasi) return;
            
            clearTimeout(inputTimer);
            
            inputTimer = setTimeout(() => {
                const kapasitas = kapasitasData[currentLokasi];
                
                const draft = {
                    bus: parseInt(document.getElementById('busInput').value) || 0,
                    mobil: parseInt(document.getElementById('mobilInput').value) || 0,
                    motor: parseInt(document.getElementById('motorInput').value) || 0,
                    timestamp: new Date().toISOString()
                };
                
                // Validate against max capacity
                if (kapasitas.bus !== null && draft.bus > kapasitas.bus) {
                    draft.bus = kapasitas.bus;
                }
                if (kapasitas.mobil !== null && draft.mobil > kapasitas.mobil) {
                    draft.mobil = kapasitas.mobil;
                }
                if (kapasitas.motor !== null && draft.motor > kapasitas.motor) {
                    draft.motor = kapasitas.motor;
                }
                
                try {
                    const drafts = JSON.parse(localStorage.getItem('parkirDrafts') || '{}');
                    drafts[currentLokasi] = draft;
                    localStorage.setItem('parkirDrafts', JSON.stringify(drafts));
                    
                    console.log(`üíæ Draft disimpan untuk lokasi ${currentLokasi}`);
                } catch (error) {
                    console.error('Error saving draft:', error);
                }
            }, 500);
        }

        // ====== SUBMIT DATA ======
        function submitData() {
            if (!currentLokasi) {
                console.error('‚ùå Tidak ada lokasi yang dipilih');
                return;
            }
            
            const kapasitas = kapasitasData[currentLokasi];
            
            // Validate and auto-correct inputs
            const bus = validateInput('busInput', kapasitas.bus);
            const mobil = validateInput('mobilInput', kapasitas.mobil);
            const motor = validateInput('motorInput', kapasitas.motor);
            
            // Check if all inputs are disabled (no capacity for this location)
            const busInput = document.getElementById('busInput');
            const mobilInput = document.getElementById('mobilInput');
            const motorInput = document.getElementById('motorInput');
            
            if (busInput.disabled && mobilInput.disabled && motorInput.disabled) {
                alert("Lokasi ini tidak memiliki kapasitas parkir yang tercatat");
                return;
            }
            
            // Check if at least one valid input exists
            let hasValidInput = false;
            if (!busInput.disabled && bus !== null && bus > 0) hasValidInput = true;
            if (!mobilInput.disabled && mobil !== null && mobil > 0) hasValidInput = true;
            if (!motorInput.disabled && motor !== null && motor > 0) hasValidInput = true;
            
            if (!hasValidInput) {
                const confirmSubmit = confirm("Semua input bernilai 0. Apakah Anda yakin ingin mengirim data?");
                if (!confirmSubmit) return;
            }
            
            // Prepare data
            const data = {
                lokasiId: currentLokasi,
                lokasiNama: lokasiData[currentLokasi].nama,
                bus: bus !== null ? bus : 0,
                mobil: mobil !== null ? mobil : 0,
                motor: motor !== null ? motor : 0,
                kapasitasMax: kapasitas, // Include max capacity for reference
                timestamp: new Date().toISOString()
            };
            
            console.log('üì§ Data dikirim:', data);
            
            // Update status
            updateStatus('Mengirim data...', '#f59e0b');
            
            // Disable submit button temporarily
            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span>‚è≥</span> MENGIRIM...';
            
            // Simulate API call
            setTimeout(() => {
                try {
                    // Save to storage
                    saveToStorage(data);
                    
                    // Clear draft
                    clearDraftData(currentLokasi);
                    
                    // Show success
                    updateStatus('‚úÖ Data berhasil dikirim!', '#10b981');
                    
                    // PERUBAHAN PENTING: TIDAK reset form
                    // Nilai tetap dipertahankan seperti yang diinput (sudah divalidasi)
                    
                    // Re-enable submit button
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = originalText;
                    
                    // Auto-reset status after 3 seconds
                    setTimeout(() => {
                        updateStatus('Siap menerima input', '');
                    }, 3000);
                    
                    // Show confirmation message
                    showToast(`Data ${lokasiData[currentLokasi].nama} berhasil dikirim!`, 'success');
                    
                    // Save as draft after submit
                    setTimeout(() => {
                        saveDraftData();
                    }, 100);
                    
                } catch (error) {
                    console.error('‚ùå Error submitting data:', error);
                    updateStatus('‚ùå Gagal mengirim data', '#ef4444');
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = originalText;
                    showToast('Gagal mengirim data', 'error');
                }
                
            }, 1500);
        }

        // ====== STORAGE FUNCTIONS ======
        function saveToStorage(data) {
            try {
                const existing = JSON.parse(localStorage.getItem('parkirUpdates') || '[]');
                
                // Remove old data for this location
                const filtered = existing.filter(item => item.lokasiId !== data.lokasiId);
                
                // Add new data
                filtered.push({
                    ...data,
                    id: Date.now()
                });
                
                // Keep only last 100 entries
                const trimmed = filtered.slice(-100);
                
                localStorage.setItem('parkirUpdates', JSON.stringify(trimmed));
                
                // Trigger storage event for other tabs
                localStorage.setItem('parkirUpdateTrigger', Date.now().toString());
                
                console.log('üíæ Data disimpan di localStorage:', data);
                return true;
                
            } catch (error) {
                console.error('Error saving data:', error);
                return false;
            }
        }

        function clearDraftData(lokasiId) {
            try {
                const drafts = JSON.parse(localStorage.getItem('parkirDrafts') || '{}');
                delete drafts[lokasiId];
                localStorage.setItem('parkirDrafts', JSON.stringify(drafts));
                console.log(`üóëÔ∏è Draft untuk lokasi ${lokasiId} dihapus`);
            } catch (error) {
                console.error('Error clearing draft:', error);
            }
        }

        // ====== UI HELPER FUNCTIONS ======
        function updateStatus(text, color = '') {
            const statusEl = document.getElementById('statusText');
            statusEl.textContent = text;
            if (color) {
                statusEl.style.color = color;
            } else {
                statusEl.style.color = '#64748b';
            }
        }

        function updateTime() {
            const now = new Date();
            const timeEl = document.getElementById('currentTime');
            if (timeEl) {
                const hours = now.getHours().toString().padStart(2, '0');
                const minutes = now.getMinutes().toString().padStart(2, '0');
                timeEl.textContent = `${hours}:${minutes}`;
            }
        }

        function formatTime(isoString) {
            const date = new Date(isoString);
            return date.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
        }

        function showToast(message, type = 'success') {
            // Remove existing toast
            const existing = document.querySelector('.custom-toast');
            if (existing) existing.remove();
            
            // Set color based on type
            let backgroundColor = '#10b981'; // success - green
            if (type === 'warning') backgroundColor = '#f59e0b'; // warning - yellow
            if (type === 'error') backgroundColor = '#ef4444'; // error - red
            
            // Create toast element
            const toast = document.createElement('div');
            toast.className = 'custom-toast';
            toast.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: ${backgroundColor};
                color: white;
                padding: 12px 24px;
                border-radius: 10px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                z-index: 1000;
                animation: slideUp 0.3s ease;
                font-size: 14px;
                font-weight: 500;
                max-width: 90%;
                text-align: center;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            // Remove after 3 seconds
            setTimeout(() => {
                toast.style.animation = 'slideDown 0.3s ease';
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        // ====== DEBUG FUNCTION ======
        function checkStorage() {
            console.log('üì¶ Checking localStorage...');
            const drafts = JSON.parse(localStorage.getItem('parkirDrafts') || '{}');
            const updates = JSON.parse(localStorage.getItem('parkirUpdates') || '[]');
            const logs = JSON.parse(localStorage.getItem('loginLogs') || '[]');
            console.log('Drafts:', drafts);
            console.log('Updates:', updates);
            console.log('Login Logs:', logs);
        }

        // ====== EVENT LISTENERS ======
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Aplikasi Petugas Parkir siap');
            
            // Setup password auto-fill
            setupPasswordAutoFill();
            
            // Auto-save draft on input change
            document.querySelectorAll('.number-input').forEach(input => {
                input.addEventListener('input', function() {
                    if (currentLokasi && !this.disabled) {
                        // Validate input in real-time
                        const kapasitas = kapasitasData[currentLokasi];
                        const value = parseInt(this.value) || 0;
                        
                        if (this.id === 'busInput' && kapasitas.bus !== null && value > kapasitas.bus) {
                            this.classList.add('warning');
                            showToast(`Maksimum bus: ${kapasitas.bus}`, 'warning');
                        } else if (this.id === 'mobilInput' && kapasitas.mobil !== null && value > kapasitas.mobil) {
                            this.classList.add('warning');
                            showToast(`Maksimum mobil: ${kapasitas.mobil}`, 'warning');
                        } else if (this.id === 'motorInput' && kapasitas.motor !== null && value > kapasitas.motor) {
                            this.classList.add('warning');
                            showToast(`Maksimum motor: ${kapasitas.motor}`, 'warning');
                        } else {
                            this.classList.remove('warning');
                        }
                        
                        saveDraftData();
                        
                        // Update status saat user menginput
                        updateStatus('Menyimpan draft...', '#3b82f6');
                        setTimeout(() => {
                            updateStatus('Draft tersimpan', '#10b981');
                            setTimeout(() => {
                                updateStatus('Siap menerima input', '');
                            }, 1500);
                        }, 500);
                    }
                });
                
                // Select semua teks saat focus untuk memudahkan edit
                input.addEventListener('focus', function() {
                    if (!this.disabled) {
                        this.select();
                    }
                });
                
                // Auto-correct on blur
                input.addEventListener('blur', function() {
                    if (!this.disabled && currentLokasi) {
                        const kapasitas = kapasitasData[currentLokasi];
                        const value = parseInt(this.value) || 0;
                        
                        // Auto-correct to max if exceeds
                        if (this.id === 'busInput' && kapasitas.bus !== null && value > kapasitas.bus) {
                            this.value = kapasitas.bus;
                            showToast(`Diubah ke maksimum: ${kapasitas.bus}`, 'warning');
                        } else if (this.id === 'mobilInput' && kapasitas.mobil !== null && value > kapasitas.mobil) {
                            this.value = kapasitas.mobil;
                            showToast(`Diubah ke maksimum: ${kapasitas.mobil}`, 'warning');
                        } else if (this.id === 'motorInput' && kapasitas.motor !== null && value > kapasitas.motor) {
                            this.value = kapasitas.motor;
                            showToast(`Diubah ke maksimum: ${kapasitas.motor}`, 'warning');
                        }
                        
                        this.classList.remove('warning');
                    }
                });
                
                // Tambahkan tombol untuk increment/decrement di mobile
                input.addEventListener('touchstart', function(e) {
                    // Untuk mobile, beri sedikit delay sebelum select
                    if (!this.disabled) {
                        setTimeout(() => {
                            this.select();
                        }, 100);
                    }
                });
            });
            
            // Update time every minute
            updateTime();
            setInterval(updateTime, 60000);
            
            // Check for existing session
            const session = localStorage.getItem('currentSession');
            if (session) {
                try {
                    const sessionData = JSON.parse(session);
                    if (sessionData.lokasiId && lokasiData[sessionData.lokasiId]) {
                        // Auto-login (but still need password)
                        document.getElementById('lokasiLogin').value = sessionData.lokasiId;
                        document.getElementById('passwordInput').value = sessionData.lokasiId;
                        validatePassword();
                    }
                } catch (error) {
                    // Invalid session
                }
            }
            
            // Debug: log storage on load
            checkStorage();
            
            // Keyboard shortcuts for login page
            const passwordInput = document.getElementById('passwordInput');
            passwordInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !document.getElementById('loginBtn').disabled) {
                    login();
                }
            });
            
            const lokasiSelect = document.getElementById('lokasiLogin');
            lokasiSelect.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && this.value) {
                    document.getElementById('passwordInput').focus();
                }
            });
        });

        // Save session on page hide
        window.addEventListener('beforeunload', function() {
            if (currentLokasi) {
                saveDraftData();
                localStorage.setItem('currentSession', JSON.stringify({
                    lokasiId: currentLokasi,
                    timestamp: new Date().toISOString()
                }));
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && document.getElementById('loginPage').style.display !== 'none') {
                if (!document.getElementById('loginBtn').disabled) {
                    login();
                }
            }
            
            if (e.key === 'Escape' && document.getElementById('inputPage').style.display !== 'none') {
                logout();
            }
            
            if (e.key === 's' && e.ctrlKey && document.getElementById('inputPage').style.display !== 'none') {
                e.preventDefault();
                submitData();
            }
            
            // Navigasi antara input dengan Tab
            if (e.key === 'Tab' && document.getElementById('inputPage').style.display !== 'none') {
                // Biarkan default behavior
            }
            
            // Submit dengan Enter di input page
            if (e.key === 'Enter' && document.getElementById('inputPage').style.display !== 'none') {
                // Cari input yang sedang aktif
                const activeElement = document.activeElement;
                if (activeElement.classList.contains('number-input')) {
                    submitData();
                }
            }
            
            // Debug shortcut: Ctrl+D untuk check storage
            if (e.key === 'd' && e.ctrlKey) {
                e.preventDefault();
                checkStorage();
            }
        });
    </script>
</body>
</html>
